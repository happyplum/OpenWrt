# 内核网络参数调整
######################################################
# 默认值 (供参考)
#
# net.ipv4.tcp_fastopen = 1
# net.core.netdev_max_backlog = 1000
# net.core.rmem_default = 212992
# net.core.wmem_default = 212992
# net.core.rmem_max = 4194304
# net.core.wmem_max = 1048576
# net.ipv4.tcp_max_syn_backlog = 128
# net.ipv4.tcp_rmem = 4096	131072	6291456
# net.ipv4.tcp_wmem = 4096	16384	4194304
#
######################################################

######################################################
# 优化值(供参考)
# 设置TCP快速打开功能，提高TCP连接性能，特别是在高并发场景下
net.ipv4.tcp_fastopen = 3

# 设置网络设备的最大backlog队列大小，提高网络设备处理能力，特别是在高并发场景下
net.core.netdev_max_backlog = 9000

# 设置内核缓冲区的默认大小，当应用程序读写数据时，如果缓冲区不足，内核会自动扩展缓冲区
net.core.rmem_default = 67108864
net.core.wmem_default = 67108864

# 设置内核缓冲区的最大值，当应用程序读写数据时，如果缓冲区超过这个值，内核会开始丢弃旧的数据包
net.core.rmem_max = 104857600
net.core.wmem_max = 104857600

# 设置TCP最大SYN队列大小，防止SYN攻击
net.ipv4.tcp_max_syn_backlog = 1024

# 设置TCP读写缓冲区的大小，当应用程序读写数据时，如果缓冲区不足，内核会自动扩展缓冲区
net.ipv4.tcp_rmem = 10240 87380 67108864
net.ipv4.tcp_wmem = 10240 87380 67108864

# 设置网络设备的流量控制，当网络设备接收到的数据包数量超过这个值时，它会开始限制新数据的接收，直到当前数据包处理完毕
# default value: 8000
net.core.netdev_budget_usecs = 16000
# default value: 300
net.core.netdev_budget = 600

# 设置网络设备的权重，当网络设备接收到的数据包数量超过这个值时，它会开始限制新数据的接收，直到当前数据包处理完毕
# default value: 64
net.core.dev_weight = 128

# 设置连接跟踪表的最大值，防止内存不足导致的程序崩溃
# default value: 65535
net.netfilter.nf_conntrack_max = 327680
# default value: 16384
net.netfilter.nf_conntrack_buckets = 81920

#
#######################################################

# 禁用TCP窗口检查，提高Nginx性能，特别是在高并发场景下
net.netfilter.nf_conntrack_tcp_no_window_check = 1

# 设置系统最少保留的内存，防止内存不足导致的程序崩溃
# default value: 16384
vm.min_free_kbytes = 32768


# 设置默认的排队规则为公平队列（Fair Queue）
net.core.default_qdisc = fq

# 设置TCP拥塞控制算法为BBR
net.ipv4.tcp_congestion_control = bbr

# 关闭空闲后的TCP慢启动
net.ipv4.tcp_slow_start_after_idle = 0
